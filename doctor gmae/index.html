<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°é†«ç”ŸéŠæˆ² (é†«ç”Ÿåœ–ç‰‡ç‰ˆ)</title>
    <style>
        /* å…¨å±€è¨­å®š */
        body {
            margin: 0;
            padding: 0;
            background-color: #FFF3E0;
            font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif;
            overflow: hidden;
            touch-action: manipulation;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            -webkit-user-select: none;
            user-select: none;
        }

        /* éŠæˆ²å®¹å™¨ */
        #game-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 100%;
            background: linear-gradient(180deg, #FFCCBC 0%, #FFF8E1 50%);
            overflow: hidden;
        }

        /* åœ°æ¿ */
        .floor {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 30%;
            background-color: #D7CCC8;
            border-top: 8px solid #8D6E63;
        }

        /* é–€ */
        .door {
            position: absolute;
            left: 0;
            bottom: 25%;
            width: 80px;
            height: 150px;
            background-color: #8D6E63;
            border-radius: 0 10px 0 0;
            z-index: 1;
        }
        .door-inner {
            width: 70px;
            height: 140px;
            background-color: #5D4037;
            margin-top: 10px;
            border-radius: 0 8px 0 0;
        }

        /* --- é€™è£¡æ”¹æˆäº†åœ–ç‰‡è¨­å®š --- */
        #doctor-img {
            position: absolute;
            right: 10px;   /* é å³è·é›¢ */
            bottom: 10%;   /* åº•éƒ¨è·é›¢ï¼Œå¯ä¾åœ–ç‰‡é•·å¯¬å¾®èª¿ */
            width: 200px;  /* é†«ç”Ÿåœ–ç‰‡å¯¬åº¦ï¼Œå¯è‡ªè¡Œèª¿æ•´ */
            height: auto;  /* é«˜åº¦è‡ªå‹•ç¶­æŒæ¯”ä¾‹ */
            z-index: 10;
            transition: transform 0.5s; /* è®“è·³èºå‹•ç•«é †æš¢ */
            
            /* å¦‚æœæ˜¯å»èƒŒåœ–ï¼ŒåŠ ä¸€é»é™°å½±æœƒæ›´æœ‰ç«‹é«”æ„Ÿ */
            filter: drop-shadow(3px 3px 5px rgba(0,0,0,0.3));
        }

        /* å‹•ç‰©å€åŸŸ (ç¶­æŒ Emoji è²¼ç´™é¢¨æ ¼) */
        #animal-stage {
            position: absolute;
            left: -300px;
            bottom: 15%;
            width: 180px;
            height: 180px;
            z-index: 5;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: left 1.5s ease-in-out, transform 0.5s;
        }
        .animal-sticker {
            font-size: 130px;
            filter: drop-shadow(2px 4px 0px rgba(0,0,0,0.2));
        }

        /* å°è©±æ¡† */
        #bubble {
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border: 6px solid #FFAB91;
            border-radius: 30px;
            padding: 20px;
            width: 85%;
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            color: #444;
            display: none;
            z-index: 20;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.1);
        }

        /* é¸é …å€ */
        #options-panel {
            position: absolute;
            bottom: 40px;
            width: 100%;
            display: flex;
            justify-content: space-around;
            z-index: 30;
            display: none;
        }
        .option-btn {
            background: white;
            border: 6px solid #81C784;
            border-radius: 50%;
            width: 85px;
            height: 85px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 6px 0 #388E3C;
            transition: transform 0.1s;
            -webkit-tap-highlight-color: transparent;
        }
        .option-btn:active {
            transform: scale(0.9);
            box-shadow: 0 2px 0 #388E3C;
        }
        .emoji-icon {
            font-size: 45px;
            pointer-events: none;
        }

        /* é–‹å§‹ç•«é¢ */
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.98);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        #start-btn {
            margin-top: 30px;
            padding: 25px 60px;
            font-size: 30px;
            font-weight: bold;
            background: #FF4081;
            color: white;
            border: none;
            border-radius: 60px;
            cursor: pointer;
            box-shadow: 0 10px 0 #C51162;
            animation: pulse 1.5s infinite;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        #start-btn:active {
            background: #F50057;
            transform: translateY(5px);
            box-shadow: 0 5px 0 #C51162;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        #progress {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.8);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            color: #555;
            z-index: 50;
            font-size: 16px;
        }
    </style>
</head>
<body>

<div id="game-container">
    <audio id="bgm" loop>
        <source src="bgm.mp3" type="audio/mpeg">
    </audio>

    <div id="progress">æº–å‚™ä¸­...</div>
    <div class="door"><div class="door-inner"></div></div>
    <div class="floor"></div>

    <img id="doctor-img" src="doctor.png" alt="é†«ç”Ÿ" onerror="alert('æ‰¾ä¸åˆ° doctor.pngï¼Œè«‹ç¢ºå®šåœ–ç‰‡æœ‰æ”¾åœ¨è³‡æ–™å¤¾ä¸­å–”ï¼')">

    <div id="animal-stage"></div>
    <div id="bubble"></div>
    <div id="options-panel"></div>

    <div id="start-screen">
        <h1 style="color:#FF4081; font-size: 40px;">å°é†«ç”ŸéŠæˆ²</h1>
        <p style="font-size: 18px; color: #666; margin-bottom: 20px;">è«‹é–‹å•ŸéŸ³é‡éŠç©å–”ï¼</p>
        <button id="start-btn">é–‹å§‹çœ‹è¨º</button>
    </div>
</div>

<script>
    const animalsData = [
        { name: "ç…å­", emoji: "ğŸ¦", text: "é†«ç”Ÿæ•‘å‘½ï¼Œæˆ‘ç™¼ç‡’äº†ï¼", correct: "icepack", options: [{ type: "icepack", icon: "ğŸ§Š" }, { type: "candy", icon: "ğŸ­" }, { type: "ball", icon: "âš½" }] },
        { name: "å…”å­", emoji: "ğŸ°", text: "å“å–²ï¼Œæˆ‘è‚šå­å¥½ç—›å–”...", correct: "medicine", options: [{ type: "pizza", icon: "ğŸ•" }, { type: "medicine", icon: "ğŸ§ª" }, { type: "car", icon: "ğŸš—" }] },
        { name: "å¤§è±¡", emoji: "ğŸ˜", text: "å“ˆå•¾ï¼æˆ‘æ„Ÿå†’æµé¼»æ¶•ã€‚", correct: "tissue", options: [{ type: "tissue", icon: "ğŸ§»" }, { type: "hammer", icon: "ğŸ”¨" }, { type: "icecream", icon: "ğŸ¦" }] },
        { name: "çŒ´å­", emoji: "ğŸµ", text: "å¥½ç—›å–”ï¼æˆ‘è·Œå€’æµè¡€äº†ã€‚", correct: "bandaid", options: [{ type: "cactus", icon: "ğŸŒµ" }, { type: "bandaid", icon: "ğŸ©¹" }, { type: "chili", icon: "ğŸŒ¶ï¸" }] },
        { name: "å°ç‹—", emoji: "ğŸ¶", text: "è…³åº•åˆºåˆ°å°–å°–çš„åˆºäº†ï¼", correct: "tweezers", options: [{ type: "rock", icon: "ğŸª¨" }, { type: "tweezers", icon: "ğŸ”§" }, { type: "balloon", icon: "ğŸˆ" }] },
        { name: "è²“å’ª", emoji: "ğŸ±", text: "ç‰™é½’ç—›ç—›çš„...", correct: "toothbrush", options: [{ type: "candy", icon: "ğŸ¬" }, { type: "toothbrush", icon: "ğŸª¥" }, { type: "drum", icon: "ğŸ¥" }] },
        { name: "å°è±¬", emoji: "ğŸ·", text: "çœ¼ç›éœ§éœ§çš„ï¼Œçœ‹ä¸æ¸…æ¥šã€‚", correct: "glasses", options: [{ type: "glasses", icon: "ğŸ‘“" }, { type: "lamp", icon: "ğŸ’¡" }, { type: "banana", icon: "ğŸŒ" }] },
        { name: "å°ç†Š", emoji: "ğŸ»", text: "æˆ‘ä¸å°å¿ƒæ‘”æ–·æ‰‹äº†ã€‚", correct: "bandage", options: [{ type: "feather", icon: "ğŸª¶" }, { type: "snake", icon: "ğŸ" }, { type: "bandage", icon: "ğŸ¤•" }] },
        { name: "å°é³¥", emoji: "ğŸ¥", text: "å–‰åš¨å¥½ç—›ï¼Œæ²’æœ‰è²éŸ³ã€‚", correct: "syrup", options: [{ type: "syrup", icon: "ğŸ¯" }, { type: "sand", icon: "â³" }, { type: "scissor", icon: "âœ‚ï¸" }] },
        { name: "é’è›™", emoji: "ğŸ¸", text: "å¥½ç†±å–”ï¼Œæˆ‘å¿«ä¸­æš‘äº†ï¼", correct: "fan", options: [{ type: "fire", icon: "ğŸ”¥" }, { type: "fan", icon: "ğŸ’¨" }, { type: "coat", icon: "ğŸ§¥" }] }
    ];

    let currentIndex = 0;
    let isTreating = false;
    let audioCtx = null;
    let gameStarted = false;

    // æ‰‹æ©ŸæŒ‰éˆ•ä¿®å¾©é‚è¼¯
    const startBtn = document.getElementById('start-btn');
    
    startBtn.addEventListener('touchstart', function(e) {
        e.preventDefault();
        initGameLogic();
    }, { passive: false });

    startBtn.addEventListener('click', function(e) {
        initGameLogic();
    });

    function initGameLogic() {
        if (gameStarted) return;
        gameStarted = true;

        startBtn.textContent = "å•Ÿå‹•ä¸­...";
        startBtn.style.backgroundColor = "#aaa";

        initAudio();

        setTimeout(() => {
            document.getElementById('start-screen').style.display = 'none';
            startGame();
        }, 300);
    }

    function initAudio() {
        try {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (AudioContext) {
                audioCtx = new AudioContext();
                if (audioCtx.state === 'suspended') {
                    audioCtx.resume();
                }
            }
            const bgm = document.getElementById('bgm');
            if(bgm) { 
                bgm.volume = 0.2; 
                bgm.play().catch(() => {}); 
            }
        } catch (e) { }
    }

    function playSound(type) {
        if (!audioCtx) return;
        if (audioCtx.state === 'suspended') audioCtx.resume();

        try {
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'success') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(660, now);
                osc.frequency.exponentialRampToValueAtTime(880, now + 0.1);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
            } else if (type === 'fail') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.3);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.linearRampToValueAtTime(0.001, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            }
        } catch (e) {}
    }

    function speak(text, pitch = 1) {
        if (!window.speechSynthesis) return;
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'zh-TW';
        utterance.rate = 0.9;
        utterance.pitch = pitch;
        window.speechSynthesis.speak(utterance);
    }

    function startGame() {
        updateProgress();
        loadAnimal();
    }

    function updateProgress() {
        document.getElementById('progress').textContent = `ç¬¬ ${currentIndex + 1} / ${animalsData.length} ä½ç—…äºº`;
    }

    function loadAnimal() {
        if (currentIndex >= animalsData.length) {
            const bubble = document.getElementById('bubble');
            bubble.textContent = "å¤ªæ£’äº†ï¼æ‰€æœ‰å°å‹•ç‰©éƒ½å¥åº·äº†ï¼";
            bubble.style.display = 'block';
            speak("å¤ªæ£’äº†ï¼æ‰€æœ‰å°å‹•ç‰©éƒ½å¥åº·äº†ï¼ä½ çœŸæ˜¯å€‹å¥½é†«ç”Ÿï¼", 1.2);
            
            // ğŸŒŸ é†«ç”Ÿåœ–ç‰‡è·³èºå‹•ç•« ğŸŒŸ
            const doc = document.getElementById('doctor-img');
            doc.style.transition = "transform 0.5s";
            doc.style.transform = "translateY(-30px)";
            return;
        }

        const data = animalsData[currentIndex];
        const stage = document.getElementById('animal-stage');
        const bubble = document.getElementById('bubble');
        const optionsPanel = document.getElementById('options-panel');
        
        bubble.style.display = 'none';
        optionsPanel.style.display = 'none';
        optionsPanel.innerHTML = '';

        stage.innerHTML = `<div class="animal-sticker">${data.emoji}</div>`;
        
        stage.style.transition = "none";
        stage.style.left = "-300px";
        
        requestAnimationFrame(() => {
            requestAnimationFrame(() => {
                stage.style.transition = "left 1.5s ease-in-out";
                stage.style.left = '20%';
            });
        });

        setTimeout(() => {
            bubble.textContent = data.text;
            bubble.style.display = 'block';
            speak(data.text, 1.4);
            setTimeout(() => {
                showOptions(data);
            }, 1000);
        }, 1500);
    }

    function showOptions(data) {
        const panel = document.getElementById('options-panel');
        panel.style.display = 'flex';
        const shuffledOptions = [...data.options].sort(() => Math.random() - 0.5);

        shuffledOptions.forEach(opt => {
            const btn = document.createElement('div');
            btn.className = 'option-btn';
            btn.innerHTML = `<div class="emoji-icon">${opt.icon}</div>`;
            
            const handleOptionClick = (e) => {
                e.preventDefault(); 
                checkAnswer(opt.type, data.correct);
            };

            btn.addEventListener('touchstart', handleOptionClick, {passive: false});
            btn.addEventListener('click', handleOptionClick);
            
            panel.appendChild(btn);
        });
    }

    function checkAnswer(selected, correct) {
        if (isTreating) return;

        if (selected === correct) {
            isTreating = true;
            playSound('success');
            
            const bubble = document.getElementById('bubble');
            bubble.textContent = "è¬è¬é†«ç”Ÿï¼";
            speak("è¬è¬é†«ç”Ÿï¼å¥½èˆ’æœå–”ï¼", 1.4);

            document.getElementById('options-panel').style.display = 'none';

            const stage = document.getElementById('animal-stage');
            stage.style.transition = "transform 0.5s";
            stage.style.transform = "translateY(-50px) rotate(10deg)";

            setTimeout(() => {
                stage.style.transform = "translateY(0)";
                setTimeout(nextLevel, 2000);
            }, 300);

        } else {
            playSound('fail');
            speak("å—¯ï¼Ÿå¥½åƒä¸æ˜¯é€™å€‹è€¶ï¼Ÿ", 1.1);
            
            // ğŸŒŸ é†«ç”Ÿåœ–ç‰‡ç–‘æƒ‘æ–æ“ºå‹•ç•« ğŸŒŸ
            const doc = document.getElementById('doctor-img');
            doc.style.transition = "transform 0.1s";
            doc.style.transform = "rotate(15deg)";
            setTimeout(() => doc.style.transform = "rotate(-15deg)", 100);
            setTimeout(() => doc.style.transform = "rotate(0deg)", 200);
        }
    }

    function nextLevel() {
        const stage = document.getElementById('animal-stage');
        stage.style.left = '120%';
        
        isTreating = false;
        currentIndex++;
        updateProgress();
        
        setTimeout(loadAnimal, 1500);
    }
</script>

</body>
</html>
